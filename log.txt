clang -target i986-none-elf -ffreestanding -Wall -Wextra -Wno-trigraphs -DRELEASE -DBOOT_FS=EXT2  -DCURRENT_YEAR=2015 -DCOM_ENABLED=1 -DLOG_SYSCALL -I. -Idrivers -Imanagers -Iprocessors -Ikmalloc -ftree-vectorize -O0 -S managers/threads/threads.c -o managers/threads/threads.s
~/opt/cross/bin/i686-elf-gcc -DDEBUG -ffreestanding -march=i686 managers/threads/threads.s -c -o managers/threads/threads.o
rm -f managers/threads/threads.s
mkdir -p build/RELEASE
~/opt/cross/bin/i686-elf-gcc -T linker.ld -o "build/RELEASE/kernel.bin" -ffreestanding -O2 -nostdlib crt0.o gdt.o idt.o cpuid.o boot.o drivers/serial/COM.o drivers/acpi_tables/acpi_tables.o drivers/apic/apic.o drivers/apic/apic_init.o drivers/apic/io_apic/io_apic.o managers/bootstrap_mem_pool/bootstrap_mem_pool.o managers/interrupt/interrupt_manager.o drivers/cmos/cmos.o drivers/fpu/fpu.o managers/msg_manager/msg_manager.o utils/native.o utils/common.o utils/sprintf.o managers/system_manager/system_manager.o drivers/pic/pic.o  graphics/graphics.o managers/filesystem/filesystem.o managers/filesystem/ext2/ext2.o managers/filesystem/ext2/ext2_helpers.o managers/keyboard/keyboard.o managers/phys_mem_manager/phys_mem_manager.o managers/threads/threads.o managers/timer/timer_manager.o managers/virt_mem_manager/virt_mem_manager.o drivers/hpet/hpet.o drivers/pci/pci.o	drivers/pci/pci_devices.o drivers/pit/pit.o drivers/ps2/ps2.o drivers/ps2/ps2_keyboard.o drivers/ps2/ps2_mouse.o drivers/ahci/ahci.o drivers/ata_pio/ata_pio.o drivers/network/network.o drivers/network/rtl8139/rtl8139.o kmalloc/kmalloc.o  processors/elf_loader/elf_loader.o processors/umalloc/umalloc.o processors/socket/socket.o processors/syscall_manager/syscall_man.o processors/process_manager/process_man.o  -lgcc
mkdir -p ISO
mkdir -p ISO/isodir
mkdir -p ISO/isodir/boot
cp "build/RELEASE/kernel.bin" ISO/isodir/boot/kernel.bin
mkdir -p ISO/isodir/boot/grub
cp grub.cfg ISO/isodir/boot/grub/grub.cfg
grub2-mkrescue -o ISO/os.iso ISO/isodir
qemu-system-x86_64 -s -S -enable-kvm -m 4096M -cpu Haswell,+xsave -d int,cpu_reset,guest_errors -drive id=disk,file=flash.img,if=none -device ahci,id=ahci -device ide-drive,drive=disk,bus=ahci.0 -netdev user,id=mynet0 -device rtl8139,netdev=mynet0 -cdrom "ISO/os.iso"
